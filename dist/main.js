(()=>{"use strict";class r{constructor(){this.array=[[" "," "," "," "," "," "," "," "," "," "],[" "," "," "," "," "," "," "," "," "," "],[" "," "," "," "," "," "," "," "," "," "],[" "," "," "," "," "," "," "," "," "," "],[" "," "," "," "," "," "," "," "," "," "],[" "," "," "," "," "," "," "," "," "," "],[" "," "," "," "," "," "," "," "," "," "],[" "," "," "," "," "," "," "," "," "," "],[" "," "," "," "," "," "," "," "," "," "],[" "," "," "," "," "," "," "," "," "," "]],this.shipArray=[],this.attackArray=[],this.sunkArray=[],this.allShipsSank=!1}placeShip(r,a,t){const e=r[0],s=r[1];if(!(a.length+e>10&&"Y"===t||a.length+s>10&&"X"===t)){if("X"===t){for(let r=s;r<s+a.length;r++)if(!1===this.checkPlacement(e,r))return;for(let r=s;r<s+a.length;r++)this.array[e][r]=a.ID}else if("Y"===t){for(let r=e;r<e+a.length;r++)if(!1===this.checkPlacement(r,s))return;for(let r=e;r<e+a.length;r++)this.array[r][s]=a.ID}return!0}}checkPlacement(r,a){for(let t=r-1;t<r+2&&(void 0!==this.array[t]||(t++,void 0!==this.array[t]));t++)for(let r=a-1;r<a+2&&(void 0!==this.array[t][r]||(r++,void 0!==this.array[t][r]));r++)if(" "!==this.array[t][r])return!1;return!0}receiveAttack(r){for(let a=0;a<this.attackArray.length;a++)if(this.attackArray[a][0]===r[0]&&this.attackArray[a][1]===r[1])return;this.attackArray.push(r);const a=r[0],t=r[1];if(" "!==this.array[a][t]){const r=this.array[a][t];this.shipArray.forEach((a=>{if(a.ID===r&&a.hit(),!0===a.sunk){for(let r=0;r<this.sunkArray.length;r++)if(this.sunkArray[r]===a)return;this.sunkArray.push(a),this.sunkArray.length===this.shipArray.length&&(this.allShipsSank=!0)}}))}else this.array[a][t]="X"}}class a{constructor(a){this.name=a,this.gameBoard=new r,this.attackArray=[]}attack(){const r=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());for(let t=0;t<this.attackArray.length;t++)if(this.attackArray[t][0]===r&&this.attackArray[t][1]===a)return void this.attack();this.attackArray.push([r,a])}}class t{constructor(r,a){this.ID=a,this.length=r,this.hits=0,this.sunk=!1}hit(){this.hits<this.length&&(this.hits+=1),this.hits===this.length&&this.isSunk()}isSunk(){this.sunk=!0}}const e=new a,s=new a;function i(){const r=[];document.querySelectorAll(".your-board > div").forEach((a=>{a.querySelectorAll("div").forEach((a=>{r.push(a.id)}))}));for(let a=0;a<e.gameBoard.array.length;a++)for(let t=0;t<e.gameBoard.array[a].length;t++)if(" "!==e.gameBoard.array[a][t]){let e=Number(a.toString()+t.toString());e=r[e],document.querySelector(`#${e}`).classList.add("ship")}}e.gameBoard.shipArray.push(new t(5,"C")),e.gameBoard.shipArray.push(new t(4,"B")),e.gameBoard.shipArray.push(new t(3,"D")),e.gameBoard.shipArray.push(new t(3,"S")),e.gameBoard.shipArray.push(new t(2,"P")),s.gameBoard.shipArray.push(new t(5,"C")),s.gameBoard.shipArray.push(new t(4,"B")),s.gameBoard.shipArray.push(new t(3,"D")),s.gameBoard.shipArray.push(new t(3,"S")),s.gameBoard.shipArray.push(new t(2,"P")),s.gameBoard.placeShip([0,6],s.gameBoard.shipArray[0],"Y"),s.gameBoard.placeShip([6,8],s.gameBoard.shipArray[1],"Y"),s.gameBoard.placeShip([3,0],s.gameBoard.shipArray[2],"X"),s.gameBoard.placeShip([6,2],s.gameBoard.shipArray[3],"X"),s.gameBoard.placeShip([0,1],s.gameBoard.shipArray[4],"Y");const h=[];i(),document.querySelectorAll(".enemy-board > div").forEach((r=>{r.querySelectorAll("div").forEach((r=>{r.addEventListener("click",(()=>{const a=r.id.slice(3,4),t=r.id.slice(5);for(let r=0;r<h.length;r++)if(h[r][0]===a&&h[r][1]===t)return;h.push([a,t]);const i=function(r,a){s.gameBoard.receiveAttack([r,a]),s.attack();const t=s.attackArray[s.attackArray.length-1];return e.gameBoard.receiveAttack(t),t}(a,t);"X"!==s.gameBoard.array[a][t]?r.classList.add("hit"):r.classList.add("miss"),function(r){const a=r[0],t=r[1],s=`P1Y${a}X${t}`,i=document.querySelector(`#${s}`);"X"!==e.gameBoard.array[a][t]?i.classList.add("hit"):i.classList.add("miss")}(i),!0!==e.gameBoard.allShipsSank&&!0!==s.gameBoard.allShipsSank||console.log("Game Over!")}))}))})),function(){const r=document.querySelector(".rotate"),a=document.querySelectorAll(".ships");a[0].style.display="grid";let t=0,s=0,h="X";const o=[];a.forEach((r=>{r.addEventListener("dragstart",(a=>{"X"===h?s=Math.floor(a.offsetX/52.5):"Y"===h&&(s=Math.floor(a.offsetY/52.5)),s<0&&(s=0),o.push(r)}))})),document.querySelectorAll(".your-board > div").forEach((r=>{r.querySelectorAll("div").forEach((r=>{r.addEventListener("dragover",(r=>{r.preventDefault()})),r.addEventListener("drop",(()=>{let c=Number(r.id.slice(3,4)),n=Number(r.id.slice(5));"X"===h?n-=s:"Y"===h&&(c-=s);const l=o[o.length-1].classList[1];e.gameBoard.shipArray.forEach((r=>{if(r.ID===l){let s=0;"X"===h?s=e.gameBoard.placeShip([c,n],r,"X"):"Y"===h&&(s=e.gameBoard.placeShip([c,n],r,"Y")),!0===s&&(a[t].style.display="none",t<4?a[++t].style.display="grid":(document.querySelector(".setup").setAttribute("hidden",!0),document.querySelector(".enemy").removeAttribute("hidden"))),i()}}))}))}))})),r.addEventListener("click",(()=>{a.forEach((r=>{"axis-x"===r.classList[2]?r.classList.replace("axis-x","axis-y"):r.classList.replace("axis-y","axis-x")})),h="X"===h?"Y":"X"}))}()})();